{% extends 'base.html' %}
{% load staticfiles %}

{% block title %}Settings{% endblock %}

{% block extra-css %}
	<link type="text/css" href="{% static 'css/date-picker.min.css' %}" rel="stylesheet" />
	<link type="text/css" href="{% static 'css/crop.css' %}" rel="stylesheet" />
{% endblock %}

{% block body %}
<section class="accountUpdate">

	<div class="container clearfix">

		<div class="profileLeft">
			<div class="panel match">

				<h1>Change profile picture</h1>

				<div id="croppic">

					{% if request.user.profile.picture %}
					<div class="circle" style="background-image:url('{{ request.user.profile.picture.url }}');"></div>
					{% else %}
					<div class="circle" style="background-image:url('{% static 'img/default-hero.png' %}');"></div>
					{% endif %}
					<a href="#0" class="btn orange js-cd-panel-trigger" data-panel="ppic" style="margin-top:10px;">Change picture</a>

					<div class="cd-panel cd-panel--from-right js-cd-panel-ppic">
					    <header class="cd-panel__header">
					        <h1>Update profile image</h1>
					        <span class="popUser">&nbsp;</span>
					        <a href="#0" class="cd-panel__close js-cd-close">Close</a>
					    </header>

					    <div class="cd-panel__container account_slide">
					        <div class="cd-panel__content">
					        	<p>Upload a new image below and crop/resize as required.</p>
					        	<form id="updatePpic" name="updatePpic" method="POST">
					        		{% csrf_token %}						        	
						        	<div class="image_container">
					        			{% if request.user.profile.picture %}
					        			<img id="blah" src="{{ request.user.profile.picture.url }}" />
					        			{% else %}
					        			<img id="blah" src="{% static 'img/default-hero.png' %}" />
					        			{% endif %}
						        	</div>
						        	<input type="file" name="image" id="image" onchange="readURL(this);"/>
						        	<div id="cropped_result"></div>
						        	<input type="hidden" name="imageb64" id="imageb64" value="">
						        	<button class="orange" id="crop_button" name="updatePpic" value="1">Update</button>	
						        </form>
					        </div>
					    </div>					
					    
					</div>

				</div>

				<h1 style="margin-top:50px;">Edit profile</h1>

				<form method="POST" enctype="multipart/form-data" id="updateprofileform">
				    {% csrf_token %}	    
				    <label>Your email address</label>
				    <p>{{ user_form.email }}</p>
				    <label>First name</label>
				    <p>{{ user_form.first_name }}</p>
				    <label>Last name</label>
				    <p>{{ user_form.last_name }}</p>
				    <label>About you</label>
				    {{ profile_form.bio }}
				    <span class="charsLeft"><span id="chars">500</span> characters remaining</span>
				    <label>Country</label>
				    <p>{{ profile_form.country }}</p>
				    <label>Date of birth</label>
				    <p>{{ profile_form.date_of_birth }}</p>
				    <label>Teephone number</label>
				    <p>{{ profile_form.phone_number }}</p>
				    <label>Your website</label>
				    <p>{{ profile_form.website }}</p>
				    <button class="btn grey" type="submit" name="updateprofile" value="updateprofile">Update profile</button>
				</form>

			</div>
		</div>

		<div class="profileRight">
			<div class="panel match">

				<h1>Edit Social</h1>

				<form method="POST" id="updatesocialform">
					{% csrf_token %}
					<strong><i class="fab fa-instagram"></i> Instagram</strong>
					<p><span>https://www.instagram.com/</span>{{ social_form.social_instagram }}</p>					

					<strong><i class="fab fa-twitter"></i> Twitter</strong>
					<p><span>https://www.twitter.com/</span>{{ social_form.social_twitter }}</p>

					<strong><i class="fab fa-facebook"></i> Facebook</strong>
					<p><span>https://www.facebook.com/</span>{{ social_form.social_facebook }}</p>

					<strong><i class="fab fa-youtube"></i> YouTube</strong>
					<p><span>https://www.youtube.com/</span>{{ social_form.social_youtube }}</p>

					<strong><i class="fab fa-twitch"></i> Twitch</strong>
					<p><span>https://www.twitch.com/</span>{{ social_form.social_twitch }}</p>

					<strong><i class="fab fa-vimeo"></i> Vimeo</strong>
					<p><span>https://www.vimeo.com/</span>{{ social_form.social_vimeo }}</p>

					<strong><i class="fab fa-pinterest"></i> Pinterest</strong>
					<p><span>https://www.pinterest.com/</span>{{ social_form.social_pinterest }}</p>

					<strong><i class="fab fa-weibo"></i> Weibo</strong>
					<p><span>https://www.weibo.com/</span>{{ social_form.social_weibo }}</p>

					<strong><i class="fab fa-vk"></i> VK</strong>
					<p><span>https://www.vk.com/</span>{{ social_form.social_vk }}</p>

					<input type="hidden" name="user" value="{{ user.id }}" id="id_user">
					<button class="btn grey" name="updatesocial" value="updatesocial">Update social links</button>
				</form>

			</div>
		</div>

	</div>

</section>
      

{% endblock %}

{% block extra-js %}

	<!--- succes alert -->
	{% if messages %}
	    {% for message in messages %}    
	        <script type="text/javascript">
	        $(function(){
	          new PNotify({
	            title: false,
	            type: "success",
	            text: {{ message }},
	            shadow: false,
	            delay: 5000,
	            buttons: {
	                sticker: false,
	            }
	          });
	        });
	        </script>
	    {% endfor %}
	{% endif %}

	<script src="{% static 'js/date-picker.min.js' %}" type="text/javascript"></script>
	<script src="{% static 'js/crop.js' %}" type="text/javascript"></script>

	<script type="text/javascript">

		function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#blah').attr('src', e.target.result)
                };
                reader.readAsDataURL(input.files[0]);
                setTimeout(initCropper, 1000);
            }
        }
	    function initCropper(){
	    	var image = document.getElementById('blah');
			var cropper = new Cropper(image, {
			  aspectRatio: 1 / 1,
			  crop: function(e) {
			    console.log(e.detail.x);
			    console.log(e.detail.y);
			  },
			  dragMode: 'move',
			  guides: false,
			  zoomable: false,
			});

			// On crop button clicked
			document.getElementById('crop_button').addEventListener('click', function(e){
	    		var imgurl =  cropper.getCroppedCanvas().toDataURL();
	    		$('#imageb64').val(imgurl)	    		
	    	})
	    }

		$('#id_social_instagram').on('input', function() {
			var input=$(this);
			var value=input.val();
			if (value.startsWith("http") || value.startsWith("www") || value.startsWith("instagram.") ){
				input.removeClass("valid").addClass("invalid");
				error = true;
			} else {
				input.removeClass("invalid").addClass("valid");
			}
		});

		// facebook
		$('#id_social_facebook').on('input', function() {
			var input=$(this);
			var value=input.val();
			if (value.startsWith("http") || value.startsWith("www") || value.startsWith("facebook.") ){
				input.removeClass("valid").addClass("invalid");
			} else {
				input.removeClass("invalid").addClass("valid");
			}
		});

		// twitter
		$('#id_social_twitter').on('input', function() {
			var input=$(this);
			var value=input.val();
			if (value.startsWith("http") || value.startsWith("www") || value.startsWith("twitter.") ){
				input.removeClass("valid").addClass("invalid");
			} else {
				input.removeClass("invalid").addClass("valid");
			}
		});

		// youtube
		$('#id_social_youtube').on('input', function() {
			var input=$(this);
			var value=input.val();
			if (value.startsWith("http") || value.startsWith("www") || value.startsWith("youtube.") ){
				input.removeClass("valid").addClass("invalid");
			} else {
				input.removeClass("invalid").addClass("valid");
			}
		});

		// twitch
		$('#id_social_twitch').on('input', function() {
			var input=$(this);
			var value=input.val();
			if (value.startsWith("http") || value.startsWith("www") || value.startsWith("twitch.") ){
				input.removeClass("valid").addClass("invalid");
			} else {
				input.removeClass("invalid").addClass("valid");
			}
		});

		// vimeo
		$('#id_social_vimeo').on('input', function() {
			var input=$(this);
			var value=input.val();
			if (value.startsWith("http") || value.startsWith("www") || value.startsWith("vimeo.") ){
				input.removeClass("valid").addClass("invalid");
			} else {
				input.removeClass("invalid").addClass("valid");
			}
		});

		// pinterest
		$('#id_social_pinterest').on('input', function() {
			var input=$(this);
			var value=input.val();
			if (value.startsWith("http") || value.startsWith("www") || value.startsWith("pinterest.") ){
				input.removeClass("valid").addClass("invalid");
			} else {
				input.removeClass("invalid").addClass("valid");
			}
		});

		// weibo
		$('#id_social_weibo').on('input', function() {
			var input=$(this);
			var value=input.val();
			if (value.startsWith("http") || value.startsWith("www") || value.startsWith("weibo.") ){
				input.removeClass("valid").addClass("invalid");
			} else {
				input.removeClass("invalid").addClass("valid");
			}
		});

		// vk
		$('#id_social_vk').on('input', function() {
			var input=$(this);
			var value=input.val();
			if (value.startsWith("http") || value.startsWith("www") || value.startsWith("vk.") ){
				input.removeClass("valid").addClass("invalid");
			} else {
				input.removeClass("invalid").addClass("valid");
			}
		});
		$(function() {
		  $('[data-toggle="datepicker"]').datepicker({
		    autoHide: true,
		    zIndex: 2048,
		  });
		});

		$('body').trigger(jQuery.Event('keydown', { keycode:38, shiftKey: true }));

		$('#updatesocialform input').keydown(function(e) {
		  if (e.shiftKey && e.which == 192) {
		    e.preventDefault();
		    new PNotify({
		      title: false,
		      type: "warning",
		      text: 'Please do not enter the @ sign',
		      shadow: false,
		      delay: 1500,
		      buttons: {
		          sticker: false,
		      }
		    });
		  }
		});

		var maxLength = 500;
		$('textarea').keyup(function() {
		  var length = $(this).val().length;
		  var length = maxLength-length;
		  $('#chars').text(length);
		});

	</script>
	
{% endblock %}